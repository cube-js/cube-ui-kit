import { Meta, Canvas, Story, Controls } from '@storybook/addon-docs/blocks';
import { LegacyComboBox } from './LegacyComboBox';
import * as LegacyComboBoxStories from './LegacyComboBox.stories';

<Meta of={LegacyComboBoxStories} />

# LegacyComboBox

A combo box combines a text input with a listbox, allowing users to filter a list of options to items matching a query. It supports both selecting from predefined options and entering custom values, making it versatile for various data entry scenarios.

## When to Use

- Allow users to select from a large list of options with filtering capability
- Enable custom value entry when predefined options aren't sufficient
- Provide autocomplete functionality for form inputs
- Offer a searchable dropdown for better user experience with extensive lists
- Support both structured selection and free-text input in one component

## Component

<Story of={LegacyComboBoxStories.Default} />

---

### Properties

<Controls of={LegacyComboBoxStories.Default} />

### Base Properties

Supports [Base properties](/docs/tasty-base-properties--docs)

### Styling Properties

#### styles

Customizes the root wrapper element of the component.

**Sub-elements:**
- `Prefix` - Element displayed before the input (icon area)
- `Suffix` - Element displayed after the input (trigger area)
- `State` - Container for validation state indicators
- `InputIcon` - Icon displayed within the input area
- `ValidationIcon` - Icon displayed for validation state

#### inputStyles

Customizes the text input element specifically.

#### popoverStyles

Customizes the dropdown popover container.

### Style Properties

The LegacyComboBox component supports all standard style properties:

`display`, `font`, `preset`, `hide`, `opacity`, `whiteSpace`, `gridArea`, `order`, `gridColumn`, `gridRow`, `placeSelf`, `alignSelf`, `justifySelf`, `zIndex`, `margin`, `inset`, `position`, `width`, `height`, `flexBasis`, `flexGrow`, `flexShrink`, `flex`, `reset`, `padding`, `paddingInline`, `paddingBlock`, `shadow`, `border`, `radius`, `overflow`, `scrollbar`, `outline`, `textAlign`, `color`, `fill`, `fade`, `textTransform`, `fontWeight`, `fontStyle`, `flow`, `placeItems`, `placeContent`, `alignItems`, `alignContent`, `justifyItems`, `justifyContent`, `align`, `justify`, `gap`, `columnGap`, `rowGap`, `gridColumns`, `gridRows`, `gridTemplate`, `gridAreas`

### Modifiers

The `mods` property accepts the following modifiers you can override:

| Modifier | Type | Description |
|----------|------|-------------|
| opened | `boolean` | Whether the dropdown is open |
| focused | `boolean` | Whether the input has focus |
| disabled | `boolean` | Whether the combo box is disabled |
| invalid | `boolean` | Whether the combo box has validation errors |
| valid | `boolean` | Whether the combo box is valid |
| loading | `boolean` | Whether the combo box is in loading state |
| hovered | `boolean` | Whether the combo box is being hovered |
| inside-form | `boolean` | Whether the combo box is inside a form field |

## Sub-components

### LegacyComboBox.Item

Individual option items within the combo box dropdown. Each item is rendered using [ItemBase](/docs/content-itembase--docs) and supports all ItemBase properties for layout, icons, descriptions, and interactive features.

#### Item API

For detailed information about all available item properties, see [ItemBase documentation](/docs/content-itembase--docs). Key properties include:

| Property | Type | Description |
|----------|------|-------------|
| key | `string \| number` | Unique identifier for the item (required) |
| children | `ReactNode` | The main content/label for the option |
| icon | `ReactNode` | Icon displayed before the content |
| rightIcon | `ReactNode` | Icon displayed after the content |
| description | `ReactNode` | Secondary text below the main content |
| descriptionPlacement | `'inline' \| 'block'` | How the description is positioned |
| prefix | `ReactNode` | Content before the main text |
| suffix | `ReactNode` | Content after the main text |
| tooltip | `string \| boolean \| object` | Tooltip configuration |
| styles | `Styles` | Custom styling for the item |
| qa | `string` | QA identifier for testing |

#### Example with Rich Items

```jsx
<LegacyComboBox label="Technologies" allowsCustomValue>
  <LegacyComboBox.Item 
    key="react" 
    icon={<IconCode />}
    description="JavaScript library"
  >
    React
  </LegacyComboBox.Item>
  <LegacyComboBox.Item 
    key="vue" 
    icon={<IconCode />}
    description="Progressive framework"
    suffix="Popular"
  >
    Vue.js
  </LegacyComboBox.Item>
</LegacyComboBox>
```

### LegacyComboBox.Section

Groups related options together with an optional heading.

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| title | `ReactNode` | - | Optional heading text for the section |
| children | `LegacyComboBox.Item[]` | - | Collection of LegacyComboBox.Item components |

## Variants

### Sizes

- `small` - Compact size for dense interfaces (28px height)
- `medium` - Standard size for general interfaces (32px height, default)
- `large` - Emphasized size for important selections (40px height)

## Examples

### Basic Usage

```jsx
<LegacyComboBox label="Select a color">
  <LegacyComboBox.Item key="red">Red</LegacyComboBox.Item>
  <LegacyComboBox.Item key="blue">Blue</LegacyComboBox.Item>
  <LegacyComboBox.Item key="green">Green</LegacyComboBox.Item>
</LegacyComboBox>
```

### With Custom Values

```jsx
<LegacyComboBox
  allowsCustomValue
  label="Enter or select a technology"
>
  <LegacyComboBox.Item key="react">React</LegacyComboBox.Item>
  <LegacyComboBox.Item key="vue">Vue</LegacyComboBox.Item>
  <LegacyComboBox.Item key="angular">Angular</LegacyComboBox.Item>
</LegacyComboBox>
```

### With Icon

```jsx
<LegacyComboBox
  label="Currency"
  icon={<IconCoin />}
  placeholder="Search currencies..."
>
  <LegacyComboBox.Item key="usd">US Dollar</LegacyComboBox.Item>
  <LegacyComboBox.Item key="eur">Euro</LegacyComboBox.Item>
  <LegacyComboBox.Item key="gbp">British Pound</LegacyComboBox.Item>
</LegacyComboBox>
```

### Loading State

```jsx
<LegacyComboBox
  label="Countries"
  loadingState="loading"
  placeholder="Loading countries..."
>
  {/* Items will be populated when loading completes */}
</LegacyComboBox>
```

### With Validation

```jsx
<LegacyComboBox
  label="Required selection"
  isRequired
  validationState="invalid"
  placeholder="Please select an option"
>
  <LegacyComboBox.Item key="option1">Option 1</LegacyComboBox.Item>
  <LegacyComboBox.Item key="option2">Option 2</LegacyComboBox.Item>
</LegacyComboBox>
```

### Disabled State

```jsx
<LegacyComboBox
  label="Disabled combo box"
  isDisabled
  placeholder="Cannot be edited"
>
  <LegacyComboBox.Item key="option1">Option 1</LegacyComboBox.Item>
</LegacyComboBox>
```

### Small Size

```jsx
<LegacyComboBox
  label="Priority"
  size="small"
  placeholder="Select priority..."
>
  <LegacyComboBox.Item key="low">Low</LegacyComboBox.Item>
  <LegacyComboBox.Item key="medium">Medium</LegacyComboBox.Item>
  <LegacyComboBox.Item key="high">High</LegacyComboBox.Item>
</LegacyComboBox>
```

## Accessibility

### Keyboard Navigation

- `Tab` - Moves focus to the combo box
- `Arrow Down` - Opens the dropdown and moves to the first/next option
- `Arrow Up` - Moves to the previous option
- `Enter` - Selects the focused option and closes dropdown
- `Escape` - Closes the dropdown without selecting
- `Home` - Moves to the first option
- `End` - Moves to the last option
- `Page Up/Down` - Moves by page in long lists
- Typing - Filters options based on input text

### Screen Reader Support

- Component announces as "combobox" to screen readers
- Current selection and filtered results are announced
- Loading and validation states are communicated
- Option count and position are announced during navigation

### ARIA Properties

- `aria-label` - Provides accessible label when no visible label exists
- `aria-labelledby` - References external label elements
- `aria-describedby` - References additional descriptive text
- `aria-expanded` - Indicates if dropdown is open
- `aria-activedescendant` - References the currently focused option
- `aria-autocomplete` - Indicates autocomplete behavior (list/both)
- `aria-required` - Indicates if selection is required
- `aria-invalid` - Indicates validation state

## Best Practices

1. **Do**: Provide clear, descriptive labels and placeholders
   ```jsx
   <LegacyComboBox
     label="Select your country"
     placeholder="Type to search countries..."
   >
   ```

2. **Don't**: Use combo box for small lists where Select would be simpler
   ```jsx
   <LegacyComboBox label="Yes or No"> {/* Use Switch or RadioGroup instead */}
   ```

3. **Performance**: Use dynamic loading for large datasets
4. **Filtering**: Provide meaningful filter results and handle empty states
5. **Custom Values**: Clearly indicate when custom values are allowed
6. **Validation**: Provide helpful error messages for validation failures

## Integration with Forms

This component supports all [Field properties](/docs/forms-field--docs) when used within a Form.

## Suggested Improvements

- Add support for multi-selection with chips/tags display
- Implement grouping for categorized options
- Add support for option descriptions or secondary text
- Consider adding async loading with debounced search
- Implement keyboard shortcuts for common actions

## Related Components

- [Select](/docs/forms-select--docs) - For simple selection without filtering
- [TextInput](/docs/forms-textinput--docs) - For free-text input without options
- [SearchInput](/docs/forms-searchinput--docs) - For search-only functionality without selection
