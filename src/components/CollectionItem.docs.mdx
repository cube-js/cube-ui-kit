import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Components/CollectionItem" />

# CollectionItem

`CollectionItem` is the building block for all collection-based components. It represents a single item in lists, menus, and selectors, providing a consistent API across the UI Kit.

## Used By

- **ListBox** - Standalone list with selection
- **FilterListBox** - List with built-in search
- **Select** - Dropdown selector with single selection
- **ComboBox** - Searchable input with suggestions
- **FilterPicker** - Filter selector with search and multiple selection
- **Picker** - Simple picker with single/multiple selection
- **Menu** - Context menu with actions
- **CommandMenu** - Keyboard-driven command palette

## Two Usage Patterns

### 1. Static JSX

Define items directly in JSX. You **must** provide `key` props manually:

```jsx live=false
import { ListBox } from '@cube-dev/ui-kit';

<ListBox>
  <ListBox.Item key="apple">Apple</ListBox.Item>
  <ListBox.Item key="banana">Banana</ListBox.Item>
</ListBox>
```

### 2. Data-driven (Recommended)

Use the `items` prop with a render function. **Do NOT** pass `key` manually - it's extracted automatically:

```jsx live=false
import { ListBox } from '@cube-dev/ui-kit';

const items = [
  { id: 'apple', name: 'Apple' },
  { id: 'banana', name: 'Banana' },
];

<ListBox items={items}>
  {(item) => <ListBox.Item>{item.name}</ListBox.Item>}
</ListBox>
```

## Data Requirements

When using the data-driven approach, each item object must include:

| Property | Required | Type | Purpose | Fallback |
|----------|----------|------|---------|----------|
| `id` or `key` | ✅ Yes | `string \| number` | Unique identifier | None - will error |
| `textValue` | ⚠️ Recommended | `string` | For filtering & accessibility | 1. Rendered content<br/>2. Key/ID |

### Unique Identifier Rules

```jsx live=false
// ✅ Good - Using 'id'
const items = [{ id: 'apple', name: 'Apple' }];

// ✅ Good - Using 'key'
const items = [{ key: 'apple', name: 'Apple' }];

// ❌ Bad - Missing unique identifier
const items = [{ name: 'Apple' }];

// ❌ Bad - Mixed types (inconsistent)
const items = [
  { id: 1, name: 'First' },      // number
  { id: '2', name: 'Second' },   // string
];
```

### textValue Rules

The `textValue` determines what text is used for filtering (in searchable components) and screen readers:

**1. Explicit (Best)** - Provide it directly for complex content:

```jsx live=false
const items = [{
  id: 'user-1',
  firstName: 'John',
  lastName: 'Smith',
  textValue: 'John Smith', // ✅ Explicit
}];

<ComboBox items={items}>
  {(item) => (
    <ComboBox.Item textValue={item.textValue}>
      {item.firstName} {item.lastName}
    </ComboBox.Item>
  )}
</ComboBox>
```

**2. Auto-derived (Good)** - Extracted from rendered content:

```jsx live=false
const items = [{ id: 'apple', name: 'Apple' }];

<ComboBox items={items}>
  {(item) => <ComboBox.Item>{item.name}</ComboBox.Item>}
  {/* textValue = "Apple" (auto-derived from rendered content) */}
</ComboBox>
```

**3. Fallback to Key (Last Resort)** - Not ideal for UX:

```jsx live=false
const items = [{ id: 'uuid-abc-123', icon: <IconUser /> }];

<ComboBox items={items}>
  {(item) => <ComboBox.Item icon={item.icon} />}
  {/* ⚠️ textValue = "uuid-abc-123" (fallback to key) */}
</ComboBox>
```

**Always provide explicit `textValue` when:**
- Rendering icons/images without text
- Using formatted/complex content
- Keys aren't human-readable (UUIDs, database IDs)
- Working with searchable components (ComboBox, FilterListBox, FilterPicker, CommandMenu)

## Properties

`CollectionItem` extends all props from the [Item component](/components/Item) including:

### Content Props

- `children` - The content of the item
- `icon` - Leading icon
- `rightIcon` - Trailing icon
- `prefix` - Content before the label
- `suffix` - Content after the label
- `description` - Secondary text below the label
- `descriptionPlacement` - Where to place description (`'inline'` | `'block'` | `'auto'`)

### Item-specific Props

- `textValue` - Text representation for filtering and accessibility
- `onAction` - Action handler for menu items
- `wrapper` - Custom wrapper for the rendered item

### Styling Props

All standard Item styling props are supported. See [Item documentation](/components/Item) for details.

## Examples

### Basic Usage

```jsx live=false
import { ListBox } from '@cube-dev/ui-kit';

// Static
<ListBox>
  <ListBox.Item key="read">Read</ListBox.Item>
  <ListBox.Item key="write">Write</ListBox.Item>
</ListBox>

// Data-driven
const permissions = [
  { id: 'read', name: 'Read' },
  { id: 'write', name: 'Write' },
];

<ListBox items={permissions}>
  {(item) => <ListBox.Item>{item.name}</ListBox.Item>}
</ListBox>
```

### With Icons

```jsx live=false
import { IconFile, IconFolder } from '@tabler/icons-react';

const items = [
  { id: 'file', name: 'File', icon: <IconFile /> },
  { id: 'folder', name: 'Folder', icon: <IconFolder /> },
];

<Menu items={items}>
  {(item) => (
    <Menu.Item icon={item.icon}>
      {item.name}
    </Menu.Item>
  )}
</Menu>
```

### With Descriptions

```jsx live=false
const users = [
  {
    id: '1',
    name: 'John Smith',
    email: 'john@example.com',
    textValue: 'John Smith john@example.com',
  },
];

<ComboBox items={users} placeholder="Search users...">
  {(item) => (
    <ComboBox.Item description={item.email}>
      {item.name}
    </ComboBox.Item>
  )}
</ComboBox>
```

### With Sections

Group related items using sections:

```jsx live=false
// Static
<ListBox>
  <ListBox.Section title="Fruits">
    <ListBox.Item key="apple">Apple</ListBox.Item>
    <ListBox.Item key="banana">Banana</ListBox.Item>
  </ListBox.Section>
  <ListBox.Section title="Vegetables">
    <ListBox.Item key="carrot">Carrot</ListBox.Item>
  </ListBox.Section>
</ListBox>

// Data-driven with nested structure
const sections = [
  {
    key: 'fruits',
    title: 'Fruits',
    children: [
      { key: 'apple', name: 'Apple' },
      { key: 'banana', name: 'Banana' },
    ],
  },
];

<ListBox items={sections}>
  {(section) => (
    <ListBox.Section title={section.title}>
      {section.children.map((item) => (
        <ListBox.Item key={item.key}>{item.name}</ListBox.Item>
      ))}
    </ListBox.Section>
  )}
</ListBox>
```

**Note:** When using `.map()` directly (not the `items` prop), you **must** provide `key` manually.

### Disabled Items

```jsx live=false
const items = [
  { id: 'read', name: 'Read', disabled: false },
  { id: 'write', name: 'Write', disabled: false },
  { id: 'delete', name: 'Delete', disabled: true },
];

<ListBox
  items={items}
  disabledKeys={items.filter(i => i.disabled).map(i => i.id)}
>
  {(item) => <ListBox.Item>{item.name}</ListBox.Item>}
</ListBox>
```

## Best Practices

### ✅ Do

```jsx live=false
// Provide explicit textValue for complex content
const items = [{
  id: 'user-1',
  name: 'John Smith',
  email: 'john@example.com',
  textValue: 'John Smith john@example.com',
}];

// Use consistent key types across all items
const items = [
  { id: '1', name: 'First' },
  { id: '2', name: 'Second' },
];

// Memoize large collections to prevent re-renders
const items = useMemo(
  () => data.map(d => ({
    id: d.id,
    name: d.name,
    textValue: d.name,
  })),
  [data]
);

// Use human-readable keys
const items = [
  { id: 'draft', status: 'Draft' },
  { id: 'published', status: 'Published' },
];
```

### ❌ Don't

```jsx live=false
// Don't manually pass key with items prop
<ListBox items={items}>
  {(item) => <ListBox.Item key={item.id}>{item.name}</ListBox.Item>}
  {/*                      ^^^^^^^^^^^^^^ Remove this! */}
</ListBox>

// Don't mix key types
const items = [
  { id: 1, name: 'First' },      // number
  { id: '2', name: 'Second' },   // string - inconsistent!
];

// Don't skip textValue for non-text content
const items = [
  { id: 'uuid-abc', icon: <IconUser /> }, // Missing textValue
];

<ComboBox items={items}>
  {(item) => <ComboBox.Item icon={item.icon} />}
  {/* Screen reader will announce "uuid-abc" - not helpful! */}
</ComboBox>

// Don't use non-human-readable keys without textValue
const items = [
  { id: 'a1b2c3d4', name: 'Item' }, // UUID without textValue
];
```

## TypeScript

Define item types for better type safety:

```tsx live=false
import { ListBox } from '@cube-dev/ui-kit';

interface User {
  id: string;
  name: string;
  email: string;
  textValue?: string;
}

function UserList() {
  const items: User[] = [
    {
      id: '1',
      name: 'John',
      email: 'john@example.com',
      textValue: 'John john@example.com',
    },
  ];

  return (
    <ListBox items={items}>
      {(item: User) => (
        <ListBox.Item description={item.email}>
          {item.name}
        </ListBox.Item>
      )}
    </ListBox>
  );
}
```

## Quick Reference

### Key Prop Handling

| Approach | Key Prop | Extracted From |
|----------|----------|----------------|
| Static JSX | ✅ Required manually | N/A |
| Data-driven (`items` prop) | ❌ Don't pass | `item.key` or `item.id` |
| Using `.map()` directly | ✅ Required manually | N/A |

### Component Capabilities

| Component | Selection | Search | Use Case |
|-----------|-----------|--------|----------|
| ListBox | Single/Multiple | ❌ | Visible list |
| FilterListBox | Single/Multiple | ✅ | Searchable list |
| Select | Single | ❌ | Dropdown |
| ComboBox | Single | ✅ | Dropdown with search |
| FilterPicker | Single/Multiple | ✅ | Filter selector |
| Picker | Single/Multiple | ❌ | Simple selector |
| Menu | Single action | ❌ | Action menu |
| CommandMenu | Single action | ✅ | Command palette |

## Essential Rules

1. **Unique ID required** - Every item needs `id` or `key` property
2. **No manual keys in data-driven mode** - React Stately handles it automatically
3. **Provide textValue explicitly** - For icons, complex content, or searchable components
4. **Consistent types** - Keep key types uniform across all items
5. **Use `.map()` exception** - When mapping directly, provide `key` manually

## Related Components

- [Item](/components/Item) - Base item component with styling
- [ListBox](/components/ListBox) - List with selection
- [Select](/components/Select) - Dropdown selector
- [ComboBox](/components/ComboBox) - Searchable input
- [Menu](/components/Menu) - Action menu

