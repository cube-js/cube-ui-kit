import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Components/CollectionItem" />

# CollectionItem

`CollectionItem` is the building block for all collection-based components in the UI Kit, providing a consistent API for list items, menu options, and selectors.

## Used By

ListBox, FilterListBox, Select, ComboBox, FilterPicker, Picker, Menu, CommandMenu

## Usage Patterns

### Static JSX

Define items directly. You **must** provide `key` props:

```jsx live=false
<ListBox>
  <ListBox.Item key="apple">Apple</ListBox.Item>
  <ListBox.Item key="banana">Banana</ListBox.Item>
</ListBox>
```

### Data-driven (Recommended)

Use `items` prop with render function. You **must** pass `key` explicitly:

```jsx live=false
const items = [
  { id: 'apple', name: 'Apple' },
  { id: 'banana', name: 'Banana' },
];

<ListBox items={items}>
  {(item) => <ListBox.Item key={item.id}>{item.name}</ListBox.Item>}
</ListBox>
```

## Item Requirements

| Property | Required | Type | Purpose |
|----------|----------|------|---------|
| `id` or `key` | ‚úÖ **Required** | `string \| number` | Unique identifier - **critical for selection callbacks** |
| `textValue` | ‚ö†Ô∏è Recommended | `string` | For filtering & accessibility |

**Without `id`/`key`:** React Aria falls back to using order-based keys (e.g., `"0"`, `"1"`), which breaks selection functionality in select components as these values are meaningless for identifying specific items.

**Without `textValue`:** Falls back to rendered content, then to key/id.

### Rules

```jsx live=false
// ‚úÖ Using 'id'
const items = [
  { id: 'apple', name: 'Apple' },
  { id: 'banana', name: 'Banana' },
];

// ‚úÖ Using 'key'
const items = [
  { key: 'apple', name: 'Apple' },
  { key: 'banana', name: 'Banana' },
];

// ‚úÖ Consistent types
const items = [
  { id: '1', name: 'First' },
  { id: '2', name: 'Second' },
];

// ‚úÖ Explicit textValue for complex content
const items = [{
  id: 'user-1',
  firstName: 'John',
  lastName: 'Smith',
  textValue: 'John Smith',
}];
```

**Always provide explicit `textValue` for:**
- Icons/images without text
- Formatted/complex content
- Non-readable keys (UUIDs)
- Searchable components (ComboBox, FilterListBox, FilterPicker, CommandMenu)

## Properties

Extends all [Item component](/components/Item) props:

- `children` - Item content
- `icon` / `rightIcon` - Icons
- `prefix` / `suffix` - Additional content
- `description` - Secondary text
- `textValue` - Text for filtering/accessibility
- `onAction` - Action handler (Menu items)

## Examples

### Basic

```jsx live=false
const permissions = [
  { id: 'read', name: 'Read' },
  { id: 'write', name: 'Write' },
];

<ListBox items={permissions}>
  {(item) => <ListBox.Item key={item.id}>{item.name}</ListBox.Item>}
</ListBox>
```

### With Icons

```jsx live=false
import { IconFile, IconFolder } from '@tabler/icons-react';

const items = [
  { id: 'file', name: 'File', icon: <IconFile /> },
  { id: 'folder', name: 'Folder', icon: <IconFolder /> },
];

<Menu items={items}>
  {(item) => <Menu.Item key={item.id} icon={item.icon}>{item.name}</Menu.Item>}
</Menu>
```

### With Descriptions

```jsx live=false
const users = [
  {
    id: '1',
    name: 'John Smith',
    email: 'john@example.com',
    textValue: 'John Smith john@example.com',
  },
];

<ComboBox items={users}>
  {(item) => (
    <ComboBox.Item key={item.id} description={item.email}>
      {item.name}
    </ComboBox.Item>
  )}
</ComboBox>
```

### With Sections

```jsx live=false
<ListBox>
  <ListBox.Section title="Fruits">
    <ListBox.Item key="apple">Apple</ListBox.Item>
    <ListBox.Item key="banana">Banana</ListBox.Item>
  </ListBox.Section>
  <ListBox.Section title="Vegetables">
    <ListBox.Item key="carrot">Carrot</ListBox.Item>
  </ListBox.Section>
</ListBox>
```

### Disabled Items

```jsx live=false
const items = [
  { id: 'read', name: 'Read' },
  { id: 'write', name: 'Write' },
  { id: 'delete', name: 'Delete', disabled: true },
];

<ListBox
  items={items}
  disabledKeys={items.filter(i => i.disabled).map(i => i.id)}
>
  {(item) => <ListBox.Item key={item.id}>{item.name}</ListBox.Item>}
</ListBox>
```

## Best Practices

```jsx live=false
// ‚úÖ Always provide id/key in data
const items = [{ id: 'user-1', name: 'John' }];

// ‚úÖ Always pass key prop
<ListBox items={items}>
  {(item) => <ListBox.Item key={item.id}>{item.name}</ListBox.Item>}
</ListBox>

// ‚úÖ Consistent types
const items = [
  { id: '1', name: 'First' },
  { id: '2', name: 'Second' },
];

// ‚úÖ Explicit textValue for complex content
const items = [{
  id: 'user-1',
  name: 'John Smith',
  textValue: 'John Smith',
}];

// ‚úÖ Memoize large collections
const items = useMemo(
  () => data.map(d => ({ id: d.id, name: d.name })),
  [data]
);

// ‚ùå Don't omit key prop
<ListBox items={items}>
  {(item) => <ListBox.Item>{item.name}</ListBox.Item>}
</ListBox>

// ‚ùå Don't mix types
const items = [
  { id: 1, name: 'First' },
  { id: '2', name: 'Second' },
];
```

## TypeScript

```tsx live=false
interface User {
  id: string;          // Required!
  name: string;
  textValue?: string;
}

const items: User[] = [
  { id: '1', name: 'John', textValue: 'John' },
];

<ListBox items={items}>
  {(item: User) => <ListBox.Item key={item.id}>{item.name}</ListBox.Item>}
</ListBox>
```

## Quick Reference

| Approach | Key Prop | Source |
|----------|----------|--------|
| Static JSX | ‚úÖ Required | Hardcoded value |
| Data-driven (`items`) | ‚úÖ Required | Pass `item.key` or `item.id` |
| Using `.map()` | ‚úÖ Required | Pass `item.key` or `item.id` |

| Component | Selection | Search |
|-----------|-----------|--------|
| ListBox | Single/Multiple | ‚ùå |
| FilterListBox | Single/Multiple | ‚úÖ |
| Select | Single | ‚ùå |
| ComboBox | Single | ‚úÖ |
| FilterPicker | Single/Multiple | ‚úÖ |
| Picker | Single/Multiple | ‚ùå |
| Menu | Single action | ‚ùå |
| CommandMenu | Single action | ‚úÖ |

## Essential Rules

1. **üö® Always provide `id` or `key` in data** - Required for selection callbacks to work properly. Without it, React Aria uses order-based keys which are useless in select components.
2. **üö® Always pass `key` prop to Item** - Must explicitly pass `key={item.id}` or `key={item.key}` in the render function
3. **Provide explicit `textValue`** - For icons, complex content, or searchable components
4. **Use consistent types** - All strings or all numbers, never mixed

## Related Components

- [Item](/components/Item) - Base item component
- [ListBox](/components/ListBox) - List with selection
- [Select](/components/Select) - Dropdown selector
- [ComboBox](/components/ComboBox) - Searchable input
- [Menu](/components/Menu) - Action menu
